<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jesse Clicker</title>
  <link rel="icon" href="https://www.ordbogen.com/apple-touch-icon.png" />
  <style>
    /* [CSS styles as previously provided] */
  </style>
</head>
<body>
  <div class="backdrop"></div>
  <h1>Jesse Clicker</h1>
  <img id="head" src="https://i.pinimg.com/736x/26/5d/fe/265dfe8eb04c534f990d78be571c085c.jpg" alt="Jesse Head" />
  <div class="score">Yo Points: <span id="score">0</span></div>

  <div class="upgrade" id="upgradeContainer"></div>
  <div id="notEnoughPoints" style="display:none;">Not enough Yo Points!</div>

  <button id="resetBtn">Reset Game</button>

  <div id="chatContainer">
    <div id="chatHeader">Public Chat</div>
    <div id="chatBox"></div>
    <input type="text" id="messageInput" placeholder="Type your message..." />
  </div>

  <div id="leaderboard">
    <div id="leaderboardHeader">Leaderboard</div>
    <div id="leaderboardBody">Coming soon...</div>
  </div>

  <div id="usernameModal">
    <div class="modalContent">
      <h2>Enter your username</h2>
      <input type="text" id="usernameInput" placeholder="Username" />
      <button id="confirmUsername">OK</button>
      <div id="usernameError"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      // Replace with your Firebase config
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM Elements
    const usernameModal = document.getElementById('usernameModal');
    const usernameInput = document.getElementById('usernameInput');
    const confirmUsername = document.getElementById('confirmUsername');
    const usernameError = document.getElementById('usernameError');
    const head = document.getElementById('head');
    const scoreDisplay = document.getElementById('score');
    const upgradeContainer = document.getElementById('upgradeContainer');
    const notEnoughPoints = document.getElementById('notEnoughPoints');
    const resetBtn = document.getElementById('resetBtn');
    const chatContainer = document.getElementById('chatContainer');
    const chatHeader = document.getElementById('chatHeader');
    const chatBox = document.getElementById('chatBox');
    const messageInput = document.getElementById('messageInput');

    let username = '';
    let score = 0;
    let autoClick = 0;
    let upgrades = [
      { name: 'Auto Clicker', cost: 200, increment: 1 }
    ];

    // Load saved data
    function loadGame() {
      const savedUsername = localStorage.getItem('username');
      if (savedUsername) {
        username = savedUsername;
        score = parseInt(localStorage.getItem('score')) || 0;
        autoClick = parseInt(localStorage.getItem('autoClick')) || 0;
        upgrades = JSON.parse(localStorage.getItem('upgrades')) || upgrades;
        usernameModal.style.display = 'none';
        updateScore();
        renderUpgrades();
        if (username === 'Walter White') {
          resetBtn.style.display = 'block';
        }
      }
    }

    // Save game data
    function saveGame() {
      localStorage.setItem('username', username);
      localStorage.setItem('score', score);
      localStorage.setItem('autoClick', autoClick);
      localStorage.setItem('upgrades', JSON.stringify(upgrades));
    }

    // Update score display
    function updateScore() {
      scoreDisplay.textContent = score;
    }

    // Render upgrades
    function renderUpgrades() {
      upgradeContainer.innerHTML = '';
      upgrades.forEach((upgrade, index) => {
        const button = document.createElement('button');
        button.textContent = `${upgrade.name} - ${upgrade.cost} Yo Points`;
        if (score >= upgrade.cost) {
          button.classList.add('affordable');
        }
        button.addEventListener('click', () => {
          if (score >= upgrade.cost) {
            score -= upgrade.cost;
            autoClick += upgrade.increment;
            upgrade.cost = Math.floor(upgrade.cost * 1.5);
            updateScore();
            renderUpgrades();
            saveGame();
          } else {
            notEnoughPoints.style.display = 'block';
            setTimeout(() => {
              notEnoughPoints.style.display = 'none';
            }, 2000);
          }
        });
        upgradeContainer.appendChild(button);
      });
    }

    // Auto clicker
    setInterval(() => {
      score += autoClick;
      updateScore();
      renderUpgrades();
      saveGame();
    }, 1000);

    // Event listeners
    confirmUsername.addEventListener('click', () => {
      const input = usernameInput.value.trim();
      if (input) {
        username = input;
        localStorage.setItem('username', username);
        usernameModal.style.display = 'none';
        if (username === 'Walter White') {
          resetBtn.style.display = 'block';
        }
        loadGame();
      } else {
        usernameError.textContent = 'Please enter a valid username.';
      }
    });

    head.addEventListener('click', () => {
      score++;
      updateScore();
      renderUpgrades();
      saveGame();
    });

    resetBtn.addEventListener('click', () => {
      if (username === 'Walter White') {
        score = 0;
        autoClick = 0;
        upgrades = [
          { name: 'Auto Clicker', cost: 200, increment: 1 }
        ];
        updateScore();
        renderUpgrades();
        saveGame();
      }
    });

    chatHeader.addEventListener('click', () => {
      const isOpen = chatBox.style.display === 'block';
      chatBox.style.display = isOpen ? 'none' : 'block';
      messageInput.style.display = isOpen ? 'none' : 'block';
    });

    messageInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const message = messageInput.value.trim();
        if (message) {
          db.collection('messages').add({
            username,
            message,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          messageInput.value = '';
        }
      }
    });

    db.collection('messages').orderBy('timestamp').onSnapshot(snapshot => {
      chatBox.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement('div');
        div.textContent = `${data.username}: ${data.message}`;
        chatBox.appendChild(div);
      });
    });

    // Initialize game
    window.onload = () => {
      loadGame();
    };
  </script>
</body>
</html>
